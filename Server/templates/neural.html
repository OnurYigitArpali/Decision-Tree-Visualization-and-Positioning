<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="//d3js.org/d3.v4.min.js"></script>
    <script>const d3_v4 = d3;</script>
    <title>Title</title>
    <style>
        .knob .cursor {
            fill: silver;
        }

        .knob .tick {
            fill: silver;
            font-size: 14px;
            font-weight: bold;
        }

        .knob .major line {
            stroke: silver;
            stroke-width: 2px;
        }
    </style>
    <script type="text/javascript" src="http://iop.io/js/vendor/d3.v3.min.js"></script>
    <script type="text/javascript" src="http://iop.io/js/vendor/polymer/PointerEvents/pointerevents.js"></script>
    <script type="text/javascript" src="http://iop.io/js/vendor/polymer/PointerGestures/pointergestures.js"></script>
    <script type="text/javascript" src="http://iop.io/js/iopctrl.js"></script>
</head>
<body>



<script>
    const svg = d3_v4.select("body")
                    .append("svg")
                    .attr('id', 'section1')
                    .attr("width", innerWidth)
                    .attr("height", innerHeight);
    let valueOfKnob = 0;
    // Drawing knob
    function drawKnob(g, r) {
        g.append("image")
                .attr("x", -r)
                .attr("y", -r)
                .attr("width", 2 * r)
                .attr("height", 2 * r)
                .attr("xlink:href", "http://iop.io/demo/iopctrl/knob.png")
    }

    const vol = iopctrl.arcslider()
                    .radius(75)
                    .indicator(drawKnob);
    vol.axis().orient("out")
            .ticks(10)
            .tickSubdivide(5)
            .tickSize(10, 6)
            .tickPadding(5)
            .scale(d3.scale.linear()
                    .domain([0, 100])
                    .range([-3*Math.PI/4,  3*Math.PI/4]));

    svg.append("g")
        .attr("class", "knob")
        .attr("transform", "scale(0.5)")
        .attr("transform", "translate(300, 200)")
        .call(vol);


    vol.onValueChanged(function(value){
        valueOfKnob = Math.round(value);
        for(let i = 0; i <= animalIndex; i++){
            const index = (Math.round(+valueOfKnob) * (i + 1)) % 4;
            decisionText[i].text = decisions[index];
            console.log(index)
        }
        svg.selectAll("text.decision")
            .text((d) => {return d.text});
    });

    //Second knob drawn
    const vol_2 = iopctrl.arcslider()
                    .radius(75)
                    .indicator(drawKnob);
    vol_2.axis().orient("out")
            .ticks(10)
            .tickSubdivide(5)
            .tickSize(10, 6)
            .tickPadding(5)
            .scale(d3.scale.linear()
                    .domain([0, 100])
                    .range([-3*Math.PI/4,  3*Math.PI/4]));

    svg.append("g")
        .attr("class", "knob")
        .attr("transform", "scale(0.5)")
        .attr("transform", "translate(300, 0)")
        .call(vol_2);

    // Drawing Knob finished
    const imageWidth = 150;
    const imageHeight = 150;
    const animalX = 100;
    const animalY = 230;
    const initTextX = 600;
    const initTextY = 240 + imageHeight / 2;
    const decisions = ["Aslan", "Arı", "Örümcek", "Kaplan"];
    const imagePos = [{x: animalX, y: animalY, text: "Arı", image: 'bee.png'},
                        {x: 0, y: 0, text: "Aslan", image: 'lion.png'},
                        {x: -300, y: 0, text: "Arı", image: 'bee_2.png'},
                        {x: -300, y: 0, text: "Aslan", image: 'lion_2.png'}];
    const decisionText = [{x: initTextX, y: initTextY, text: decisions[0]}];
    const trainButton = svg.append("rect")
                            .attr("class", "button")
                            .attr("x", 700)
                            .attr("y", 220)
                            .attr("width", 140)
                            .attr("height", 50)
                            .attr("fill", "orange");
    let animalIndex = 0;
    trainButton.on('click', () => {
        //Image positions set
        for(let i = imagePos.length - 2; i >= animalIndex; i--) {
            imagePos[i + 1].x = imagePos[i].x;
            imagePos[i + 1].y = imagePos[i].y;
        }
        imagePos[animalIndex].x = 300 * animalIndex + 120;
        imagePos[animalIndex].y = 500;
        svg.selectAll("image.animal")
            .data(imagePos)
            .transition()
            .attr("x", (d) => {return d.x})
            .attr("y", (d) => {return d.y});

        //Texts set
        decisionText[decisionText.length - 1].x = 300 * animalIndex + 160;
        decisionText[decisionText.length - 1].y = 490;
        decisionText.push({x: initTextX, y: initTextY, text: decisions[0]});
        const texts = svg.selectAll("text.decision")
            .data(decisionText)
            .enter()
            .append("text")
            .attr("class", "decision")
            .attr("text-anchor", "middle")
            .attr("alignment-baseline", "middle")
            .attr("font-size", "30")
            .text((d) => {return d.text});
        svg.selectAll("text.decision")
            .attr("x", (d) => {return d.x})
            .attr("y", (d) => {return d.y})
        animalIndex++;

        for(let i = 0; i <= animalIndex; i++){
            const index = ((Math.round(+valueOfKnob) * (i + 1))) % 4;
            decisionText[i].text = decisions[index];
        }
        svg.selectAll("text.decision")
            .text((d) => {return d.text})
    });
    // Layout
    svg.selectAll("image.animal")
        .data(imagePos)
        .enter()
            .append("svg:image")
            .attr("class", "animal")
            .attr("x", (d) => {return d.x})
            .attr("y", (d) => {return d.y})
            .attr("width", imageWidth)
            .attr("height", imageHeight)
            .attr("xlink:href", (d) => {return "../icons/" + d.image});

    //Texts laid out
    svg.selectAll("text.decision")
        .data(decisionText)
        .enter()
            .append("text")
            .attr("class", "decision")
            .attr("text-anchor", "middle")
            .attr("alignment-baseline", "middle")
            .attr("font-size", "30")
            .attr("x", (d) => {return d.x})
            .attr("y", (d) => {return d.y})
            .text((d) => {return d.text});
</script>
</body>
</html>